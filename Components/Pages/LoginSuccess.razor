@page "/login-success"
@using MyBarMenu.Client.Services.Interfaces
@inject NavigationManager Navigation
@inject IAuthService _authService
@rendermode InteractiveServer


<h3>Logged in successfully 🎉</h3>

@code {
    private bool _hasRun;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender && !_hasRun)
        {
            _hasRun = true;

            var uri = Navigation.ToAbsoluteUri(Navigation.Uri);
            if (Microsoft.AspNetCore.WebUtilities.QueryHelpers.ParseQuery(uri.Query).TryGetValue("token", out var token))
            {
                await _authService.LoginAsync(token);

                Navigation.NavigateTo("/app", forceLoad: true);
            }
            else
            {
                Navigation.NavigateTo("/login");
            }
        }
    }
}
